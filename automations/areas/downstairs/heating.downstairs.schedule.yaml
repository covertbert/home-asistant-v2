- alias: Heating - Downstairs - Schedule
  mode: single

  triggers:
    # Has the state of the schedule just changed
    - trigger: state
      entity_id:
        - schedule.downstairs_daytime
        - schedule.downstairs_evening
    # Has anyone just come/left home?
    - trigger: state
      entity_id:
        - input_boolean.home_state
    # Has 15 minutes elapsed?
    - trigger: time_pattern
      minutes: /15

  # Living Room window is closed
  condition:
    - condition: state
      entity_id: binary_sensor.living_room_window_opening
      state: "off"

  action:
    - choose:
        # No one is home
        - conditions:
            - condition: state
              entity_id: input_boolean.home_state
              state: "off"
          sequence:
            - action: climate.set_temperature
              data:
                temperature: 18
              target:
                entity_id: climate.downstairs

        # Evening schedule activated
        - conditions:
            - condition: state
              entity_id: schedule.downstairs_evening
              state: "on"
          sequence:
            - action: climate.set_temperature
              data:
                temperature: 20
              target:
                entity_id: climate.downstairs

        # Daytime schedule activated
        - conditions:
            - condition: state
              entity_id: schedule.downstairs_daytime
              state: "on"
          sequence:
            - action: climate.set_temperature
              data:
                temperature: 19
              target:
                entity_id: climate.downstairs

      default:
        - action: climate.set_temperature
          data:
            temperature: 18
          target:
            entity_id: climate.downstairs
